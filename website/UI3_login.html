<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link rel="stylesheet" href="assets/css/styles2.css"> -->
    <link rel="stylesheet" href="assets/css/UI3.css">

    <script src="https://unpkg.com/htmx.org"></script>
	<script src="https://unpkg.com/jquery.min.js"></script>

    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/radar.js"></script>

    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/geodata/continentsLow.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
	<script src="https://cdn.amcharts.com/lib/5/geodata/lang/FR.js"></script>

	<script src="scripts/graph/amTools.js"></script>

    <script src="scripts/graph/linePays.js"></script>
    <script src="scripts/graph/lineCompare.js"></script>
    <script src="scripts/graph/barreLine.js"></script>
	<script src="scripts/graph/spider.js"></script>
	<script src="scripts/graph/barCompare.js"></script>

	<script src="scripts/js/functions.js"></script>
    <script src="scripts/map/map.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar" hx-boost="true" hx-target="#grille" hx-select="#grille" hx-swap="outerHTML show:body:top swap:0.5s">
    
        <div class="right-nav">
            <a href="monde.php">Monde</a>
            <a href="pays.php">Pays</a>
            <a href="continent.php">Continent</a>
            <a href="comparateur.php">Comparateur</a>
        </div>
    
        <div class="img-nav">
            <a href="index.php"><img src="assets/img/eco.png"></a>
        </div>
    
        <div class="left-nav">
            <a href="calculateur.php">Calculateur</a>
            <a href="inscription.php" >S'inscrire</a>
            <a href="connexion.php">Se connecter</a>
        </div>
    
    </nav>

    <div class="flex">
        <div class="grid">
            <div class="zone-totale column" id="barl">
                <h1 class="titre">Connexion</h1>
                <img class="logo" src="assets/img/profil.png" alt="LogoProfil">

            <div class="connexion-container">
                <form id="loginForm" onsubmit="return validateForm()">
                    <label for="username">Nom d'utilisateur</label>
                    <input type="text" id="username" name="username" placeholder="Saisissez votre nom d'utilisateur" required autocomplete="off">
                    <div id="errorUsername" class="error"></div>

                    <label for="password">Mot de passe</label>
                    <input type="password" id="password" name="password" placeholder="Saisissez votre mot de passe" required autocomplete="off">
                    <div id="errorPassword" class="error"></div>

                    <!-- Ajouter un champ pour le token CSRF -->
                    <input type="hidden" name="csrf_token" id="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">

                    <input type="submit" value="Se connecter" style="background-color: #52796F; color: white; border: 1px solid #52796F; border-radius: 8px; font-size: 16px; width:150px; display: block; margin: 0 auto;">
                    <div id="errorMessages" class="error"></div>
                </form>

                <script>
                    function validateForm() {
                        var username = $("#username").val();
                        var password = $("#password").val();

                        if (username === '' || password === '') {
                            $("#errorMessages").html("Veuillez remplir tous les champs.");
                            return false;
                        }

                        return true;
                    }

                    $(document).ready(function () {
                        $("#loginForm").on('submit', function(e) {
                            e.preventDefault(); // Empêcher le formulaire de se soumettre normalement
                            var formData = $(this).serialize(); // Sérialiser les données du formulaire
                            // Envoyer la demande Ajax pour traiter la connexion
                            $.ajax({
                                method: 'POST',
                                url: "connecter.php",
                                data: formData,
                                dataType: 'json',
                                success: function (response) {
                                    // Traiter la réponse du serveur ici
                                    $("#errorMessages").html(response.message);
                                    if (response.success) {
                                        window.location.href = 'ok.php';
                                    } else {
                                        alert('Erreur de connexion : ' + response.message);
                                    }
                                },
                                error: function (xhr, status, error) {
                                    console.error("Erreur lors de la requête Ajax vers connecter.php:", error);
                                    $("#errorMessages").html("Une erreur s'est produite lors de la connexion.");
                                }
                            });
                        });
                    });
                </script>
            </div>
            </div>

        </div>
    </div>    
    
</body>
</html>